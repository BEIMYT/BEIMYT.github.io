<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Glossa – Online Interpreter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" href="favicon.png">
  <link rel="stylesheet" href="style.css">

  <style>
    body {
      font-family: monospace;
      background: #2c0202;
      color: #fff;
      text-align: center;
      padding: 20px;
    }

    textarea {
      width: 90%;
      height: 220px;
      background: #120000;
      color: #fff;
      border: 1px solid #aa4444;
      padding: 10px;
      font-size: 15px;
      resize: vertical;
    }

    button {
      margin: 15px;
      padding: 10px 25px;
      font-size: 16px;
      background: #aa4444;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #cc6666;
    }

    pre {
      width: 90%;
      margin: auto;
      background: #120000;
      border: 1px solid #aa4444;
      padding: 10px;
      min-height: 120px;
      text-align: left;
      white-space: pre-wrap;
    }

    .btn-github {
      margin-top: 25px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      transition: transform 0.3s ease;
    }

    .btn-github:hover {
      transform: scale(1.1);
      color: #ffaaaa;
    }
  </style>
</head>

<body>

<h1><u>Glossa (Online)</u></h1>
<p>Run Glossa directly in your browser</p>

<textarea id="code">
gia i apo 1 mexri 2
  emfanise "2"
telos_gia
</textarea>

<br>
<button onclick="run()">Run ▶</button>

<pre id="output"></pre>

<a class="btn-github" href="https://github.com/BEIMYT/Glossa" target="_blank">
  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
    <path d="M8 1.333A6.667 6.667 0 0 0 1.333 8c0 2.94 1.914 5.44 4.56 6.333.333.054.44-.146.44-.326v-1.14c-1.86.4-2.254-.9-2.254-.9-.307-.774-.754-.98-.754-.98-.607-.414.047-.406.047-.406.667.047 1.02.687 1.02.687.586 1.013 1.56.72 1.94.56.06-.433.233-.727.42-.894-1.48-.167-3.034-.74-3.034-3.273 0-.726.253-1.32.686-1.793-.066-.167-.3-.86.067-1.76 0 0 .56-.18 1.84.687.526-.146 1.1-.22 1.667-.22.566 0 1.14.074 1.666.22 1.28-.867 1.84-.687 1.84-.687.367.9.133 1.593.067 1.76.433.473.686 1.067.686 1.793 0 2.54-1.56 3.1-3.046 3.26.24.206.46.613.46 1.233v1.826c0 .18.107.387.447.326A6.667 6.667 0 0 0 14.667 8 6.667 6.667 0 0 0 8 1.333z"/>
  </svg>
  View on GitHub
</a>

<script>
let vars = {};
let output = "";

function print(txt="") {
  output += txt + "\n";
}

function evalExpr(expr) {
  expr = expr.replace("<>", "!=")
             .replace(/=/g, "==")
             .replace("<==", "<=")
             .replace(">==", ">=");
  try {
    return Function("vars", "with(vars){return " + expr + "}")(vars);
  } catch {
    return expr;
  }
}

function runBlock(lines) {
  for (let i = 0; i < lines.length; i++) {
    let line = lines[i].trim();
    if (!line) continue;

    let t = line.split(/\s+/);
    let cmd = t[0];

    // Assignment
    if (t.includes("<-")) {
      vars[t[0]] = evalExpr(t.slice(2).join(" "));
    }

    // Print
    else if (cmd === "emfanise" || cmd === "ektipose") {
      let arg = t.slice(1).join(" ");
      if (arg.startsWith('"') && arg.endsWith('"')) {
        print(arg.slice(1, -1));
      } else if (vars[arg] !== undefined) {
        print(vars[arg]);
      } else {
        print(evalExpr(arg));
      }
    }

    // IF
    else if (cmd === "an") {
      let block = [];
      while (!lines[i].includes("telos_an")) {
        block.push(lines[i]);
        i++;
      }
      let head = block[0].split("tote");
      if (evalExpr(head[0].replace("an", "").trim())) {
        runBlock(block.slice(1));
      }
    }

    // WHILE
    else if (cmd === "oso") {
      let block = [];
      let cond = line.split("epanalave")[0].replace("oso", "").trim();
      while (!lines[i].includes("telos_oso")) {
        block.push(lines[++i]);
      }
      while (evalExpr(cond)) runBlock(block);
    }

    // FOR
    else if (cmd === "gia") {
      let v = t[1];
      let start = evalExpr(t[t.indexOf("apo")+1]);
      let end = evalExpr(t[t.indexOf("mexri")+1]);
      let body = [];
      while (!lines[i].includes("telos_gia")) body.push(lines[++i]);
      for (let x = start; x <= end; x++) {
        vars[v] = x;
        runBlock(body);
      }
    }

    else {
      print("Δεν αναγνωρίζω την εντολή: " + line);
    }
  }
}

function run() {
  vars = {};
  output = "";
  let lines = document.getElementById("code").value.split("\n");
  runBlock(lines);
  document.getElementById("output").textContent = output;
}
</script>

</body>
</html>
