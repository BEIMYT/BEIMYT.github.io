<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Glossa</title>
  <link rel="icon" href="favicon.png" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4PKVYPG2JS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4PKVYPG2JS');
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #2c0202;
      color: #fffefe;
      padding: 20px;
      text-align: center;
    }

    textarea {
      width: 90%;
      max-width: 800px;
      height: 220px;
      background: #120101;
      color: #fff;
      border: 1px solid #aa4444;
      padding: 12px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
    }

    button {
      margin-top: 10px;
      padding: 10px 18px;
      background: #aa4444;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 15px;
    }

    button:hover {
      background: #cc5555;
    }

    #output {
      margin: 20px auto;
      width: 90%;
      max-width: 800px;
      background: #120101;
      border: 1px solid #aa4444;
      padding: 12px;
      text-align: left;
      min-height: 120px;
      white-space: pre-wrap;
      font-family: monospace;
    }

    .btn-github {
      margin-top: 25px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      transition: transform 0.2s ease;
    }

    .btn-github:hover {
      transform: scale(1.05);
    }
  </style>
</head>

<body>

<h1><u>Glossa – Live Interpreter</u></h1>

<p>Write Glossa code below and run it directly in your browser.</p>

<textarea id="code">
x <- 5
emfanise "Hello Glossa"
emfanise x
</textarea>
<br>
<button onclick="runGlossa()">Run ▶</button>

<div id="output"></div>

<!-- GitHub Button (UNCHANGED) -->
<a href="https://github.com/BEIMYT/Glossa" target="_blank" class="btn-github">
  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
    <path fill="currentColor"
      d="M8 1.33A6.67 6.67 0 0 0 1.33 8c0 2.95 1.92 5.45 4.56 6.33.33.06.44-.14.44-.31v-1.09c-1.86.4-2.25-1.29-2.25-1.29-.31-.77-.74-.97-.74-.97-.61-.41.05-.4.05-.4.67.05 1.02.69 1.02.69.6 1.02 1.58.73 1.97.56.06-.44.24-.73.43-.9-1.48-.17-3.04-.74-3.04-3.27 0-.72.26-1.31.69-1.77-.07-.17-.3-.86.07-1.79 0 0 .56-.18 1.83.68.53-.15 1.1-.22 1.67-.22.57 0 1.14.07 1.67.22 1.27-.86 1.83-.68 1.83-.68.37.93.14 1.62.07 1.79.43.46.69 1.05.69 1.77 0 2.54-1.56 3.1-3.05 3.26.25.21.46.63.46 1.27v1.88c0 .17.11.38.44.31A6.67 6.67 0 0 0 14.67 8 6.67 6.67 0 0 0 8 1.33Z"/>
  </svg>
  <span>View on GitHub</span>
</a>

<script>
let variables = {};
let output = document.getElementById("output");

function print(msg="") {
  output.textContent += msg + "\n";
}

function evalExpr(expr) {
  try {
    expr = expr.replace(/<>/g, "!=")
               .replace(/=/g, "==")
               .replace(/<==/g, "<=")
               .replace(/>==/g, ">=");
    return Function("vars", `with(vars){ return ${expr} }`)(variables);
  } catch {
    return expr;
  }
}

function runProgram(lines) {
  for (let i = 0; i < lines.length; i++) {
    let line = lines[i].trim();
    if (!line) continue;

    let tokens = line.split(" ");
    let cmd = tokens[0];

    // Assignment
    if (line.includes("<-")) {
      let [v, expr] = line.split("<-");
      variables[v.trim()] = evalExpr(expr.trim());
    }

    // Print
    else if (cmd === "emfanise" || cmd === "ektipose") {
      let arg = line.slice(cmd.length).trim();
      if (arg.startsWith('"') && arg.endsWith('"'))
        print(arg.slice(1, -1));
      else if (variables[arg] !== undefined)
        print(variables[arg]);
      else
        print(evalExpr(arg));
    }

    // Input
    else if (cmd === "diavase") {
      let v = tokens[1];
      let val = prompt(`${v} =`);
      variables[v] = isNaN(val) ? val : Number(val);
    }

    else {
      print("Δεν αναγνωρίζω την εντολή: " + line);
    }
  }
}

function runGlossa() {
  output.textContent = "";
  variables = {};
  let code = document.getElementById("code").value.split("\n");
  runProgram(code);
}
</script>

</body>
</html>
